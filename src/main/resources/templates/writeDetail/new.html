<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<head>
    <meta charset="UTF-8">
    <title>조은북</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>




    <script th:inline="javascript">
        function updateForm(id) {
            var form = document.getElementById('updateForm');
            form.action = "/detail/novel/update/" + id;
            form.submit();
        }


         $(document).ready(function() {
          $('#alarm_non_check').show();
          $('#alarm_check').hide();
           $('#day').hide();


          $('#alarm_non_check').click(function() {
                $('#alarm_non_check').hide();
                $('#alarm_check').show();
                $('#day').show();
            });

            $('#alarm_check').click(function() {
                $('#alarm_non_check').show();
                $('#alarm_check').hide();
                 $('#day').hide();
            });


        const maxLength = 8000;  // 최대 글자 수

        $('#input').on('input', function() {
            var textLength = $(this).val().length;
            var remaining = maxLength - textLength;
            $('#charCount').text(`글자 수: ${textLength}/${maxLength}`);
            if (remaining < 0) {
                $('#charCount').css('color', 'red');
            } else {
                $('#charCount').css('color', '#6c757d');
            }
        });




    });




    </script>

    <style>
        .title {
            margin-top: 30px;
            margin-bottom: 30px;
            font-size: 2rem;
            font-weight: bold;
        }

        .form-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f8f9fa;
        }

        .form-container textarea {
            resize: vertical;
        }

        .btn-custom {
            margin-top: 10px;
        }

        .char-count {
            font-size: 0.875rem;
            color: #6c757d;
        }

        span {
            display: flex;
            align-items: center; /* 수직 정렬 */
            gap: 10px; /* 요소 간의 간격 */
        }

        /* 숨김 설정 */
        #alarm_non_check, #alarm_check {
            display: flex;
            align-items: center; /* 수직 정렬 */
        }

        /* 입력 필드와 텍스트에 여백 추가 */
        #day {
            display: flex;
            align-items: center;
            gap: 10px; /* 요소 간의 간격 */
        }

        /* 숨김 설정 */
        #alarm_check {
            display: none; /* 기본적으로 숨김 */
        }

        /* 오른쪽 정렬 */
        .form-group-right {
            text-align: right;
        }
    </style>

</head>

<body>



<div layout:fragment="content">
    <div class="form-container">
        <h3 th:text="${writeInfo.title}" class="title"></h3>
        <form id="updateForm" th:action="@{/novel/new/add/{id}(id=${writeInfo.id})}" role="form" method="post" th:object="${WriteDetailDto}">
            <input type="hidden" th:field="*{id}">
            <input type="hidden" th:field="*{writeInfo.id}">
            <div class="form-group">
                <label for="miniTitle">제목</label>
                <input type="text" id="miniTitle" class="form-control" th:field="*{miniTitle}">
            </div>
            <div class="form-group">
                <label for="input">내용</label>
                <textarea id="input" class="form-control" cols="100" rows="30" th:field="*{miniWrite}"></textarea>
                <div id="charCount" class="char-count">글자 수: 0/8,000</div>
            </div>

            <span>
                <div id="alarm_non_check">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-alarm" viewBox="0 0 16 16">
                      <path d="M8.5 5.5a.5.5 0 0 0-1 0v3.362l-1.429 2.38a.5.5 0 1 0 .858.515l1.5-2.5A.5.5 0 0 0 8.5 9z"/>
                      <path d="M6.5 0a.5.5 0 0 0 0 1H7v1.07a7.001 7.001 0 0 0-3.273 12.474l-.602.602a.5.5 0 0 0 .707.708l.746-.746A6.97 6.97 0 0 0 8 16a6.97 6.97 0 0 0 3.422-.892l.746.746a.5.5 0 0 0 .707-.708l-.601-.602A7.001 7.001 0 0 0 9 2.07V1h.5a.5.5 0 0 0 0-1zm1.038 3.018a6 6 0 0 1 .924 0 6 6 0 1 1-.924 0M0 3.5c0 .753.333 1.429.86 1.887A8.04 8.04 0 0 1 4.387 1.86 2.5 2.5 0 0 0 0 3.5M13.5 1c-.753 0-1.429.333-1.887.86a8.04 8.04 0 0 1 3.527 3.527A2.5 2.5 0 0 0 13.5 1"/>
                    </svg>
                </div>
                <div id="alarm_check">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-alarm-fill" viewBox="0 0 16 16">
                      <path d="M6 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1H9v1.07a7.001 7.001 0 0 1 3.274 12.474l.601.602a.5.5 0 0 1-.707.708l-.746-.746A6.97 6.97 0 0 1 8 16a6.97 6.97 0 0 1-3.422-.892l-.746.746a.5.5 0 0 1-.707-.708l.602-.602A7.001 7.001 0 0 1 7 2.07V1h-.5A.5.5 0 0 1 6 .5m2.5 5a.5.5 0 0 0-1 0v3.362l-1.429 2.38a.5.5 0 1 0 .858.515l1.5-2.5A.5.5 0 0 0 8.5 9zM.86 5.387A2.5 2.5 0 1 1 4.387 1.86 8.04 8.04 0 0 0 .86 5.387M11.613 1.86a2.5 2.5 0 1 1 3.527 3.527 8.04 8.04 0 0 0-3.527-3.527"/>
                    </svg>
                </div>
                <div id="day">
                     예약 설정
                     <input type="text" name="Dday" id="Dday" placeholder="MM/DD/YYYY"/>
                    <select id="DTime">
                        <option>--</option>
                        <option value="00">00</option>
                        <option value="01">01</option>
                        <option value="02">02</option>
                        <option value="03">03</option>
                        <option value="04">04</option>
                        <option value="05">05</option>
                        <option value="06">06</option>
                        <option value="07">07</option>
                        <option value="08">08</option>
                        <option value="09">09</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                    </select>시
                </div>

                </span>
            <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
            <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
            <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

            <script>

                $(function() {
                       let Time='';
                       let Day= '';
                       let Timer= '';
                      var today = moment().subtract(1, 'days').startOf('day');
                      $('#Dday').daterangepicker({
                          singleDatePicker: true,
                          showDropdowns: true,
                          minYear: 2024,
                          maxYear: 2025,
                          minDate: today, // 오늘 날짜보다 이전 날짜 선택 불가
                          startDate: today // 기본 선택 날짜를 오늘 날짜로 설정
                      }, function(start, end, label) {
                          var selectedDate = start; // 선택된 날짜 (moment 객체)
                          var year = selectedDate.year(); // 년도 추출
                          var month = selectedDate.month() + 1; // 월 추출 (0 기반 인덱스, 1을 더하여 1 기반으로 변환)
                          var day = selectedDate.date(); // 일 추출

                          var Day = selectedDate.format('YYYY-MM-DD');
                          $('#regDate').val(Day);


                          Time = $('#DTime').val();
                          Day = $('#regDate').val();

                          if (Day) {
                             Timer = Day + 'T' + Time + ':00';
                              $('#regTime').val(Timer);
                          }


                      });

                      $('#DTime').change(function(){
                          Time = $('#DTime').val();
                          Day = $('#regDate').val();

                          if (Day) {
                             Timer = Day + 'T' + Time + ':00';
                              $('#regTime').val(Timer);
                          }
                      });
                  });



            </script>
           <input type="hidden" th:field="*{reserveDate}" id="regDate" >
           <input type="hidden" th:field="*{reserveTime}" id="regTime" >



            <div class="form-group">
                <div th:if="${#strings.isEmpty(WriteDetailDto.id)}">
                    <button id="save" type="submit" class="btn btn-primary btn-custom">저장</button>
                </div>
                <div th:unless="${#strings.isEmpty(WriteDetailDto.id)}">
                    <button type="button" th:value="${WriteDetailDto.id}" onclick="updateForm(this.value)" class="btn btn-warning btn-custom">수정</button>
                </div>
            </div>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        </form>

    </div>
</div>
</body>


</html>