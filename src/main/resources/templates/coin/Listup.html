<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />

    <title>Title</title>

    <!-- Bootstrap CSS 포함 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- Bootstrap JavaScript 포함 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

</head>
<th:block layout:fragment="script">
    <script th:inline="javascript">
        $(document).ready(function () {
              $('#current').change(function() {
                  // 선택된 값 가져오기
                  var selectValue = $(this).val();

                  // 모든 카드 숨기기
                  $('.card').hide();

                  // 선택된 값에 따라 카드 표시
                  if (selectValue === "KDR") {
                      $('#KDR').show();
                      KDR();
                  } else if (selectValue === "YES") {
                      $('#YES').show();
                      YES();
                  }
              });

              // 페이지 로드 시 현재 선택된 값에 따라 카드 표시
              $('#current').trigger('change');



                $('#KDR_coin').change(function(){
            //코인을 선택하면 현재 가격에 대한 합계 포인트 사용 비용이 나온다.
            var KDR_stck=$('#KDR_stck_prpr').text();
            var count = $(this).val();


            var total =  (KDR_stck) * (count);
            $('#KDR_total').text(total);

        })


                $('#YES_coin').change(function(){
            //코인을 선택하면 현재 가격에 대한 합계 포인트 사용 비용이 나온다.
            var YES_stck=$('#YES_stck_prpr').text();
            var count = $(this).val();


            var total =  (YES_stck) * (count);
            $('#YES_total').text(total);

        })



        });


          //만약에 키다리 스튜디오를 선택할 경우, 해당 주식 금액이 나온다.
        function KDR() {
            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");

            url = "/equities/020120";

            $.ajax({
                url: url,
                type: "POST",
                contentType: "application/json",
                beforeSend: function (xhr) {
                    // 데이터 전송하기 전에 헤더에 csrf 값을 설정
                    xhr.setRequestHeader(header, token);
                },
                dataType: "json",
                cache: false,
                success: function (result, status) {
                    var equity = result.equity;

                    var stck_prpr = equity.stck_prpr;

                    $('#KDR_stck_prpr').text(stck_prpr);

                    $('#KDR_total').text(stck_prpr);
                },
                error: function (jqXHR, status, error) {
                    if (jqXHR.status == '401') {
                        alert('로그인 후 이용해주세요');
                        location.href = '/members/login';
                    } else {
                        alert(jqXHR.responseText);
                    }
                }
            });
        }




         function YES() {//예스 24를 선택할 경우 해당 주식의 가격이 나온다.
                var token = $("meta[name='_csrf']").attr("content");
                var header = $("meta[name='_csrf_header']").attr("content");

                url = "/equities/053280";

                $.ajax({
                    url: url,
                    type: "POST",
                    contentType: "application/json",
                    beforeSend: function (xhr) {
                        // 데이터 전송하기 전에 헤더에 csrf 값을 설정
                        xhr.setRequestHeader(header, token);
                    },
                    dataType: "json",
                    cache: false,
                    success: function (result, status) {
                        var equity = result.equity;

                        var stck_prpr = equity.stck_prpr;
                         console.log(stck_prpr);
                        $('#YES_stck_prpr').text(stck_prpr);


                        $('#YES_total').text(stck_prpr);


                    },
                    error: function (jqXHR, status, error) {
                        if (jqXHR.status == '401') {
                            alert('로그인 후 이용해주세요');
                            location.href = '/members/login';
                        } else {
                            alert(jqXHR.responseText);
                        }
                    }
                });
            }




    </script>
</th:block>

    <th:block layout:fragment="css">
    <style>


    </style>
    </th:block>



<div layout:fragment="content">


    <select id="current">
        <option th:value="KDR">키다리스튜디오(020120)</option>
        <option th:value="YES">예스24(053280)</option>
    </select>
    <div class="h4 pb-2 mb-4 text-danger border-bottom border-info"></div>
    <div class="card" id="KDR">
        <div class="card-header">
            <h2>키다리스튜디오(020120)</h2>
        </div>
        <div class="card-body">
            <div>
                <span class="fs-1" id="KDR_stck_prpr"></span>원<!--주식의 현재 가격을 나타내는 변수나 속성 이름-->
            </div>
            <div>
                <span>변경 코인 수량</span>
                <select id="KDR_coin">
                    <option value="1">1코인</option>
                    <option value="10">10코인</option>
                    <option value="25">25코인</option>
                    <option value="50">50코인</option>
                    <option value="100">100코인</option>
                </select>

            </div>
            <div>
                총<span id="KDR_total"></span>포인트
            </div>

        </div>
    </div>


    <div class="card" id="YES">
        <div class="card-header">
            <h2>예스24(053280)</h2>
        </div>
        <div class="card-body">
            <div>
                <span class="fs-1" id="YES_stck_prpr"></span>원<!--주식의 현재 가격을 나타내는 변수나 속성 이름-->
            </div>
            <div>
                <span>변경 코인 수량</span>
                <select id="YES_coin">
                    <option value="1">1코인</option>
                    <option value="10">10코인</option>
                    <option value="25">25코인</option>
                    <option value="50">50코인</option>
                    <option value="100">100코인</option>
                </select>

            </div>
            <div>
                총<span id="YES_total"></span>포인트
            </div>
        </div>
    </div>







</div>



</html>